---
import BaseLayout from './BaseLayout.astro';

const {
  title,
  description,
  date,
  kind,
  backlinks = [],
  typeLabel,
  subtype,
  typeIcon,
  typeKey,
  lastUpdated
} = Astro.props;
const formattedDate = date
  ? new Intl.DateTimeFormat('en-US', { dateStyle: 'medium' }).format(date)
  : null;
const meta = [formattedDate, kind].filter(Boolean).join(' | ');
const formattedLastUpdated = lastUpdated
  ? new Intl.DateTimeFormat('en-CA', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit'
    }).format(lastUpdated)
  : null;
---

<BaseLayout title={title}>
  <article class="article">
    <header class="article-header">
      {typeLabel ? (
        <div class="content-type" data-type={typeKey}>
          {typeIcon ? <img src={typeIcon} alt="" loading="lazy" /> : null}
          <span>{typeLabel}</span>
          {subtype ? (
            <>
              <span class="content-type-divider">|</span>
              <span>{subtype}</span>
            </>
          ) : null}
        </div>
      ) : null}
      <h1>{title}</h1>
      {description ? <p class="lede">{description}</p> : null}
      {meta ? <p class="meta">{meta}</p> : null}
    </header>
    <div class="prose">
      <slot />
    </div>

    {backlinks.length ? (
      <section class="section">
        <h2>Backlinks</h2>
        <ul class="list">
          {backlinks.map((link) => (
            <li>
              <a href={link.url}>{link.title}</a>
            </li>
          ))}
        </ul>
      </section>
    ) : null}

    {formattedLastUpdated ? (
      <div class="content-updated">Last updated {formattedLastUpdated}</div>
    ) : null}
  </article>
</BaseLayout>
